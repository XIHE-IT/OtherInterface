<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>地址校验</title>
		<style>
			/* 基本重置和全局样式 */
			body,
			html {
				margin: 0;
				padding: 0;
				font-family: Arial, sans-serif;
				height: 100%;
				overflow: hidden;
				/* 防止滚动条 */
			}

			.form-container {
				max-width: 400px;
				margin: 0px auto 50px;
				padding: 20px;
				box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
				border-radius: 8px;
				/* background-color: rgba(255, 255, 255, 0.2); */
				/* 半透明白色背景 */
			}

			/* 输入框和时间选择框的样式 */
			.form-input {
				width: calc(100% - 82px);
				/* 减去padding */
				padding: 10px;
				margin: 5px 0;
				border: 1px solid #ccc;
				border-radius: 12px;
				box-sizing: border-box;
				/* 让padding不影响宽度 */
				transition: all 0.3s ease;
				/* border: none;
				  pointer-events: none; */
			}

			.form-input:focus {
				border-color: #007bff;
				outline: none;
				box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
			}

			/* 提交按钮样式 */
			button {

				color: black;
				padding: 10px 20px;
				border: none;
				border-radius: 12px;
				cursor: pointer;
				transition: background-color 0.3s ease;
			}

			button[type="submit"] {
				background-color: #007bff;
			}

			.btnView {
				display: flex;
				justify-content: space-around;
				margin: 5px 30px;
				width: calc(100% - 22px);
			}

			@keyframes gradientBG {
				0% {
					background-position: 0% 50%;
				}

				50% {
					background-position: 100% 50%;
				}

				100% {
					background-position: 0% 50%;
				}
			}

			.container {
				position: relative;
				padding: 30px;
				border-radius: 10px;
				background: rgba(255, 255, 255, 0.3);
				backdrop-filter: blur(5px);
				/* 模糊背景，增强可读性 */
				box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
				max-width: 360px;
				margin: auto;
				top: 50%;
				/* transform: translateY(-50%);   */
				color: #333;
				text-align: left;
			}

			.title {
				font-size: 28px;
				color: #007bff;
				margin-bottom: 20px;
			}

			.slogan {
				font-size: 20px;
				line-height: 1.6;
				margin-bottom: 15px;
			}

			.flex {
				display: flex;
				align-items: center;
			}

			label {
				width: 60px;
				font-size: 14px;
				margin-right: 5px;
				text-align: right;
				font-weight: 600;
			}

			.custom-select {
				width: calc(100% - 82px);
				/* 根据需要调整宽度 */
				padding: 8px;
				font-size: 16px;
				line-height: 1;
				border: 1px solid #ccc;
				/* 边框颜色 */
				border-radius: 12px;
				/* 边框圆角 */
				outline: none;
				/* 移除焦点轮廓 */
				background-color: white;
				/* 背景色 */
				appearance: none;
				/* 移除默认的下拉箭头（在大多数现代浏览器中有效） */
				-webkit-appearance: none;
				/* 针对Safari和Chrome */
				background-image: url('data:image/svg+xml;utf8,<svg fill="black" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>');
				/* 使用SVG作为自定义下拉箭头，你可以替换为其他图标 */
				background-repeat: no-repeat;
				background-position: right 10px center;
				/* 调整箭头位置 */
			}

			/* 可选：当鼠标悬停在下拉框上时改变边框颜色 */
			.custom-select:hover {
				border-color: #888;
			}

			.custom-select option {
				padding: 10px;
				font-size: 16px;
				color: #333;
			}

			.custom-select option:hover {
				background-color: #f0f0f0;
			}


			.content {
				font-weight: 600;
				text-align: center;
				padding: 20px 20px;
				font-size: 40px;
				color: white;
			}

			.background {
				position: absolute;
				top: 0;
				left: 0;
				background: url('/static/img/bg_img.png');
				background-repeat: no-repeat;
				background-position: center center;
				background-size: cover;
				width: 100%;
				height: 100%;
				z-index: -1;
				opacity: .7;
			}

			textarea {
				width: calc(100% - 82px);
				/* 减去padding */
				padding: 10px;
				margin: 5px 0;
				border: 1px solid #ccc;
				border-radius: 12px;
				box-sizing: border-box;
				transition: all 0.3s ease;
			}

			.title-view {
				position: absolute;
				z-index: 1;
				font-size: 28px;
				font-weight: bold;
				text-align: center;
				top: 0;
				left: 0;
				width: 100%;
				padding: 8px 0px;
				background-color: #5cabeb;
				color: #d0c300;
			}

			.loading-view {
				position: absolute;
				top: 0;
				left: 0;
				right: 0;
				bottom: 0;
				background-color: rgba(255, 255, 255, 0.5);
				display: none;
				justify-content: center;
				align-items: center;

			}

			.loader {
				border: 12px solid #f3f3f3;
				/* Light grey */
				border-top: 12px solid #3498db;
				/* Blue */
				border-radius: 50%;
				width: 45px;
				height: 45px;
				animation: spin 2s linear infinite;

			}

			@keyframes spin {
				0% {
					transform: rotate(0deg);
				}

				100% {
					transform: rotate(360deg);
				}
			}

			.flag {
				display: none;
			}
		</style>
	</head>

	<body>
		<div class="background"></div>

		<div class="form-container">
			<!-- <div class="title-view">
				商业/住宅查询
			</div> -->
			<form id="myForm" action="">
				<div class="flex">
					<div class="flex" style="flex: 1;">
						<label for="countryCode">国家:</label>
						<select id="countryCode" name="countryCode" class="custom-select">
							<option value="US">美国</option>
						</select>
					</div>
					<div class="flex" style="flex: 1;">
						<label for="type">服务商:</label>
						<select id="type" name="type" class="custom-select">
							<option value="ups">UPS</option>
							<option value="fedex">FEDEX</option>
						</select>
					</div>

				</div>
				<div class="flex" style="justify-content: center;">
					<textarea placeholder="输入地址自动识别，示例:600 BloomingdaleRd Bloomingdale GA 31302" id="addressList"
						cols="42" rows="5" style="resize: none;margin-left:46px;"></textarea>
					<!-- <span>确定</span> -->
				</div>
				<div class="flag">
					<div class="flex">
						<div class="flex">
							<label for="politicalDivision1">省州:</label>
							<input type="text" id="politicalDivision1" name="politicalDivision1" class="form-input">
						</div>
						<div class="flex">
							<label for="politicalDivision2">城市:</label>
							<input type="text" id="politicalDivision2" name="politicalDivision2" class="form-input">
						</div>
					</div>
					<div class="flex">
						<label for="postcodePrimaryLow">邮编:</label>
						<input type="text" id="postcodePrimaryLow" name="postcodePrimaryLow" class="form-input">
					</div>
					<div class="flex">
						<label for="addressLine">地址:</label>
						<textarea name="addressLine" id="addressLine" cols="42" rows="5"
							style="resize: none;"></textarea>
					</div>

				</div>
				<div class="btnView">
					<button type="submit">查询</button>
					<button type="reset" onclick="resetForm()">重置</button>
				</div>
			</form>
			<div class="content">
				<!-- 未知/商业/住宅/混合 -->
			</div>
			<div
				style="color: rgb(171, 1, 1);font-size: 12px;padding: 15px;border-radius: 10px;font-weight: bold;background-color: rgba(255,255,255, 0.5);">
				说明：地址分类有四种：未知、公司、住宅和混合。<br>
				混合：当某个地点是基于多租户的地址且同时包含
				公司和住宅单元时。<br>
				未知：查询非公司、住宅、混合时为未知
			</div>
			<div
				style="position: absolute;color: #d0c300;bottom: 0;left:0;width: 100%;text-align: center;padding: 8px 0;font-size: 14px;">
				上海品客国际物流有限公司
			</div>


		</div>
		<div class="loading-view">
			<div class="loader"></div>
		</div>
		<script>
			let eleFlag = document.querySelector('.flag');
			const handleInputChange = (value) => {
				return new Promise((resolve) => {
					let ele = document.querySelector('.loading-view');
					ele.style.display = 'flex'
					const params = new URLSearchParams();
					params.append('address', value);
					fetch('/cityPost/interceptAddress', {
							method: 'POST',
							headers: {
								'Content-Type': 'application/x-www-form-urlencoded',
								'Authorization': 'ad9aff53-6671-4386-9a0e-c9ddc910b6ef'
							},
							body: params.toString()
						})
						.then(response => response.json())
						.then(data => {
							ele.style.display = 'none'
							if (data.code == 200) {
								eleFlag.style.display = 'block'
								let p1 = document.getElementById("politicalDivision1")
								let p2 = document.getElementById("politicalDivision2")
								let p3 = document.getElementById("postcodePrimaryLow")
								let a1 = document.getElementById("addressLine")
								let {
									townname,
									province,
									postcode,
									addressArr,
									address
								} = data.data
								p1.value = province
								p2.value = townname
								p3.value = postcode
								a1.value = address
								resolve()
							} else {
								alert(data.msg)
								resolve()
							}
						})
						.catch(error => {
							ele.style.display = 'none';
							console.error('Error:', error)
						});
				})
			};

			const input = document.getElementById('addressList')
			let changeEventFired = false;
			const myForm = document.getElementById("myForm");
			input.addEventListener('change', async function() {
				changeEventFired = true;

				await handleInputChange(input.value.replace(/\n/g, ' '));
				input.dispatchEvent(new CustomEvent('customChange'));
			});
			input.addEventListener('customChange', function() {;
				_fun();
			});

			function _fun() {
				var formData = new FormData(myForm); // 创建FormData对象
				let obj = {
					"type": "",
					"consigneeName": "",
					"buildingName": "",
					"addressLine": [],
					"region": "",
					"politicalDivision1": "",
					"politicalDivision2": "",
					"postcodePrimaryLow": "",
					"postcodeExtendedLow": "",
					"urbanization": "",
					"countryCode": ""
				}
				for (var pair of formData.entries()) {
					if (pair[0] == 'addressLine') {
						obj[pair[0]] = [pair[1]]
					} else {
						obj[pair[0]] = pair[1]
					}
				}
				let ele = document.querySelector('.loading-view');
				ele.style.display = 'flex'
				let content = document.querySelector(".content")
				const map = {
					0: '未分类',
					1: '商业',
					2: '住宅',
					3: '混合'
				};
				fetch('/cityPost/checkHome', {
						method: 'POST',
						headers: {
							'Content-Type': 'application/json',
							'Authorization': 'ad9aff53-6671-4386-9a0e-c9ddc910b6ef'
						},
						body: JSON.stringify(obj)
					})
					.then(response => response.json())
					.then(data => {
						console.log(data);
						let num = data.data
						let {code,msg} = data
						ele.style.display = 'none'
						if(code==200){
							content.innerText = map[num]
						}else{
							alert(msg)
						}
						
					})
					.catch(error => {
						ele.style.display = 'none';
						console.error('Error:', error)
					});
			}
			myForm.addEventListener('submit', async (event) => {
				event.preventDefault();
				_fun()
			})

			function resetForm() {
				let content = document.querySelector(".content")
				content.innerText = ''
				document.getElementById("myForm").reset();
				eleFlag.style.display = 'none'
			}
		</script>
	</body>

</html>